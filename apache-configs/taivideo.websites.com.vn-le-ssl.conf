<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerName taivideo.websites.com.vn
    ServerAdmin admin@websites.com.vn

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/taivideo-ssl-error.log
    CustomLog ${APACHE_LOG_DIR}/taivideo-ssl-access.log combined

    # Reverse Proxy to Docker container
    ProxyPreserveHost On
    ProxyRequests Off

    # Proxy all requests to Cobalt API container
    ProxyPass / http://127.0.0.1:5001/
    ProxyPassReverse / http://127.0.0.1:5001/

    # WebSocket support (if needed)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)  ws://127.0.0.1:5001/$1 [P,L]

    # Security Headers
    # Note: CORS headers are handled by the Cobalt API itself, not Apache
    # This prevents duplicate headers that cause CORS errors
    Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"

    # Timeout settings for long downloads
    ProxyTimeout 300
    Timeout 300

    # SSL Configuration (will be added/updated by certbot)
    SSLCertificateFile /etc/letsencrypt/live/taivideo.websites.com.vn/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/taivideo.websites.com.vn/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
</VirtualHost>
</IfModule>
