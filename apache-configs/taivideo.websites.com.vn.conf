<VirtualHost *:80>
    ServerName taivideo.websites.com.vn
    ServerAdmin admin@websites.com.vn

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/taivideo-error.log
    CustomLog ${APACHE_LOG_DIR}/taivideo-access.log combined

    # Reverse Proxy to Docker container
    ProxyPreserveHost On
    ProxyRequests Off

    # Proxy all requests to Cobalt API container
    ProxyPass / http://127.0.0.1:5001/
    ProxyPassReverse / http://127.0.0.1:5001/

    # WebSocket support (if needed)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)  ws://127.0.0.1:5001/$1 [P,L]

    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer-when-downgrade"

    # CORS Headers (if needed for API)
    Header always set Access-Control-Allow-Origin "*"
    Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
    Header always set Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization"

    # Handle OPTIONS requests
    <If "%{REQUEST_METHOD} == 'OPTIONS'">
        Header always set Access-Control-Max-Age "1728000"
        Header always set Content-Type "text/plain; charset=utf-8"
        Header always set Content-Length "0"
    </If>

    # Timeout settings for long downloads
    ProxyTimeout 300
    Timeout 300
</VirtualHost>

# SSL Configuration (will be added by certbot)
# <VirtualHost *:443>
#     ServerName taivideo.websites.com.vn
#     ServerAdmin admin@websites.com.vn
#
#     # SSL Certificate files (managed by certbot)
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/taivideo.websites.com.vn/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/taivideo.websites.com.vn/privkey.pem
#     Include /etc/letsencrypt/options-ssl-apache.conf
#
#     # Logs
#     ErrorLog ${APACHE_LOG_DIR}/taivideo-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/taivideo-ssl-access.log combined
#
#     # Reverse Proxy to Docker container
#     ProxyPreserveHost On
#     ProxyRequests Off
#
#     ProxyPass / http://127.0.0.1:5001/
#     ProxyPassReverse / http://127.0.0.1:5001/
#
#     # WebSocket support
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} =websocket [NC]
#     RewriteRule /(.*)  ws://127.0.0.1:5001/$1 [P,L]
#
#     # Security Headers
#     Header always set X-Frame-Options "SAMEORIGIN"
#     Header always set X-XSS-Protection "1; mode=block"
#     Header always set X-Content-Type-Options "nosniff"
#     Header always set Referrer-Policy "no-referrer-when-downgrade"
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
#
#     # CORS Headers
#     Header always set Access-Control-Allow-Origin "*"
#     Header always set Access-Control-Allow-Methods "GET, POST, OPTIONS"
#     Header always set Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization"
#
#     # Timeout settings
#     ProxyTimeout 300
#     Timeout 300
# </VirtualHost>
