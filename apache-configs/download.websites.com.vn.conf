<VirtualHost *:80>
    ServerName download.websites.com.vn
    ServerAdmin admin@websites.com.vn

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/download-error.log
    CustomLog ${APACHE_LOG_DIR}/download-access.log combined

    # Reverse Proxy to Docker container
    ProxyPreserveHost On
    ProxyRequests Off

    # Proxy all requests to Web Interface container
    ProxyPass / http://127.0.0.1:5002/
    ProxyPassReverse / http://127.0.0.1:5002/

    # WebSocket support (if needed for real-time features)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)  ws://127.0.0.1:5002/$1 [P,L]

    # Security Headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    Header always set Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https:; style-src 'self' 'unsafe-inline' https:;"

    # Caching for static assets
    <LocationMatch "\.(jpg|jpeg|png|gif|ico|css|js|woff|woff2|ttf|svg)$">
        Header set Cache-Control "max-age=31536000, public"
    </LocationMatch>

    # Timeout settings
    ProxyTimeout 300
    Timeout 300
</VirtualHost>

# SSL Configuration (will be added by certbot)
# <VirtualHost *:443>
#     ServerName download.websites.com.vn
#     ServerAdmin admin@websites.com.vn
#
#     # SSL Certificate files (managed by certbot)
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/download.websites.com.vn/fullchain.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/download.websites.com.vn/privkey.pem
#     Include /etc/letsencrypt/options-ssl-apache.conf
#
#     # Logs
#     ErrorLog ${APACHE_LOG_DIR}/download-ssl-error.log
#     CustomLog ${APACHE_LOG_DIR}/download-ssl-access.log combined
#
#     # Reverse Proxy to Docker container
#     ProxyPreserveHost On
#     ProxyRequests Off
#
#     ProxyPass / http://127.0.0.1:5002/
#     ProxyPassReverse / http://127.0.0.1:5002/
#
#     # WebSocket support
#     RewriteEngine On
#     RewriteCond %{HTTP:Upgrade} =websocket [NC]
#     RewriteRule /(.*)  ws://127.0.0.1:5002/$1 [P,L]
#
#     # Security Headers
#     Header always set X-Frame-Options "SAMEORIGIN"
#     Header always set X-XSS-Protection "1; mode=block"
#     Header always set X-Content-Type-Options "nosniff"
#     Header always set Referrer-Policy "no-referrer-when-downgrade"
#     Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
#     Header always set Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https:; style-src 'self' 'unsafe-inline' https:;"
#
#     # Caching for static assets
#     <LocationMatch "\.(jpg|jpeg|png|gif|ico|css|js|woff|woff2|ttf|svg)$">
#         Header set Cache-Control "max-age=31536000, public"
#     </LocationMatch>
#
#     # Timeout settings
#     ProxyTimeout 300
#     Timeout 300
# </VirtualHost>
